<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <title>神経衰弱ゲーム</title>
    <style>
        body {
            background-color:#8FBC8F;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            
        }
        h1 {
            text-align: center; /* 中央揃え */
            font-size: 40px; /* フォントサイズ */
            color: black; /* 文字色 */
        }
        
        /* h2タグのスタイル */
        h2 {
            text-align: center; /* 中央揃え */
            font-size: 30px; /* フォントサイズ */
            color: black; /* 文字色 */
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-gap: 40px;
            width: fit-content;
            margin: auto;
        }
        .card {
            position: relative;
            width: 120px;
            height: 170px;
            cursor: pointer;
            background-size: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
        }
        .hidden {
            visibility: hidden;/*要素はあるけど見えない*/
        }
        .matched .number {
            color: red;
        }
        .number {
            position: absolute;
            z-index: 1;
        }
        button {
            width: 100%;
            max-width: 320px;
            height: 64px;
            padding: 8px 24px;
            font-family: sans-serif;
            font-size: 20px;
            color: #5c73b7;
            border: none; /* 枠線の色をなしに設定 */
            text-align: center;
            overflow-wrap: anywhere;
            background-color: #fff56c;
            border-radius: 32px; /* (buttonの高さ / 2) の値 */
            margin-bottom: 16px; /* ボタンの下に少し余白をつける */
            font-weight: bold;
  
        }
        #clearMessage {
            display: none; /* 初期状態では非表示 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: lightgreen;
            font-size: 2em;
            text-align: center;
            border-radius: 10px;
            z-index: 2;
        }
        
    </style>
</head>
<body>
    <h1>神経衰弱ゲーム</h1>
    <h2>1～9までの数字をそろえよう！</h2>
    <div class="card-grid" id="cardGrid"></div>
    <div id="clearMessage">クリア!!</div>

    <button id="reset">カードシャッフル</button>
    <script>
        const music = new Audio('GB-Action-D10-1(Clear).mp3');
        const music2 = new Audio('カードめくり1.mp3');
        const music3 = new Audio('Quiz-Correct_Answer01-1.mp3');

        $(function(){
            let totalCards = 18; // 合計カード数18枚
            let cards = []; // カードの配列
            let card1 = Array.from({length: totalCards / 2}, function(_, i) {
                return i + 1;
            }); // カード1〜9を生成
            let card2 = [...card1]; // card1コピー　ペア作成

            cards = card1.concat(card2); // カードを結合してペアを作る

            // Durstenfeld Shuffle
            function durstenfeldShuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // カード配列をシャッフル
            cards = durstenfeldShuffle(cards);

            // カードを生成してカードグリッドに追加
            for (let i = 0; i < totalCards; i++) {
                let cardId = `card_${i}`;
                $("#cardGrid").append(`<div class="card" id="${cardId}" data-card-value="${cards[i]}" style="background-image: url('card_back.png');"><span class="number hidden">${cards[i]}</span></div>`);
            }

            let firstCard = null;
            let secondCard = null;
            let matches = 0;
            //let time = 60; // 初期設定：60秒
            //let interval;

            // カードクリックイベント
            $(".card").click(function() {
    if ($(this).hasClass('hidden') || $(this).hasClass('matched')) return;
    if (firstCard && secondCard) return; // すでに2枚選ばれている場合は無視
    if (firstCard && $(this).is(firstCard)) return; // 同じカードを2回クリックできないようにする
    music2.play();
    $(this).css('background-image', 'url(card_front.png)');//背景　カード表
    $(this).find('.number').removeClass('hidden');//hiddenのクラスを消去
    
    if (!firstCard) {
        firstCard = $(this);
    } else {
        secondCard = $(this);

        if (firstCard.data('card-value') === secondCard.data('card-value')) {//1枚目と２枚目同じとき
            firstCard.addClass('matched');
            secondCard.addClass('matched');
            //firstCard.find('.number');//css('color', 'red'
            //secondCard.find('.number');
            matches += 1;
            setTimeout(() => {
                music3.play(); // 数字がマッチした時0.4秒語music3を再生
            }, 400);
            
            if (matches === totalCards / 2) {//カードがすべてマッチしたとき
                $("#clearMessage").show(); //クリア表示
                setTimeout(() => {
                music.play(); // 数字がマッチしたとき0.6秒後music3を再生
            }, 600);
            }
            firstCard = null;
            secondCard = null;
        } else {
            //music2.play();
            setTimeout(() => {
                firstCard.css('background-image', 'url(card_back.png)');//背景をカードbackに変更
                secondCard.css('background-image', 'url(card_back.png)');
                firstCard.find('.number').addClass('hidden');//.css('color', 'black')
                secondCard.find('.number').addClass('hidden');//数字隠す
                firstCard = null;
                secondCard = null;
            }, 1000);//1秒後にカード裏返し
        }
    }
});

            // リセットボタンの動作
            $("#reset").click(function() {
                location.reload();
            });

           

        });
    </script>
</body>
</html>
